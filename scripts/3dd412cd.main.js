function extend(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}IncomeChart=function(){function a(a,b,c,d){var e=this;e.container=d3.select(a),defaultOpts={yMax:1},e.opts=extend(defaultOpts,d),e.data=b,e.income=c,e.description=e.container.append("div").attr("class","description").html('Men en inkomst på <span class="income"></span> tjänar du mer än <span class="amount"></span> av <span class="profession"></span> inom <span class="publicprivate"></span>.'),e.xOrdinal=d3.scale.ordinal().domain(b.map(function(a){return a.income}));var f=b[0].incomeUpper,g=b[b.length-1].incomeLower;e.xLinear=d3.scale.linear().domain([f,g]),e.y=d3.scale.linear().domain([0,e.opts.yMax]),e.drawChart(),d3.select(window).on("resize",function(){e.resize()})}return a.prototype.drawChart=function(){var a=this,b=a.container[0][0].offsetWidth;a.margins=m={top:40,right:.1*b,bottom:100,left:50},a.width=w=b-m.left-m.right,a.height=h=.5*w,a.pointRadius=.01*b;.7*m.bottom+"px";a.description.style("left",m.left+.6*w+"px").style("top",m.top+.05*h+"px").style("max-width",m.left+.25*w+"px"),a.svg=a.container.append("svg").attr("width",w+m.left+m.right).attr("height",h+m.top+m.bottom),a.chart=a.svg.append("g").attr("transform","translate("+m.left+", "+m.top+")"),a.xOrdinal.rangeBands([0,w],0,0),a.xLinear.range([0,w]),a.y.range([h,0]);var c=d3.svg.axis().scale(a.xOrdinal).orient("bottom"),d=d3.svg.axis().scale(a.y).tickFormat(formatPercent).orient("left");a.chart.append("g").attr("class","y axis").call(d);var e=a.chart.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(c);e.selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),e.append("text").attr("x",w/2).attr("y",m.bottom-20).attr("dy",".7em").style("text-anchor","middle").attr("class","title").text("Inkomstgrupp"),a.incomeLine=a.chart.append("g").attr("class","income-line"),a.incomeLine.append("line").attr("class","line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",h+m.top),a.incomeLine.append("text").attr("transform","rotate(90)").attr("y",-5).attr("class","label").text("Din lön"),a.barGroups=a.chart.selectAll(".bar-group").data(a.data,function(a){return a.income}).enter().append("g").attr("class","bar-group").attr("transform",function(b){var c=a.xOrdinal(b.income),d=a.y(b.value);return"translate("+c+","+d+")"}),a.barGroups.append("rect").attr("class","bar").attr("width",a.xOrdinal.rangeBand()).attr("height",function(b){return h-a.y(b.value)}),a.updateIncomeLine(a.income)},a.prototype.updateData=function(a){var b=this;b.data=a;var c=700,d=b.barGroups.data(b.data,function(a){return a.income}).transition().duration(c);d.attr("transform",function(a){var c=b.xOrdinal(a.income),d=b.y(a.value);return"translate("+c+","+d+")"}),d.select(".bar").attr("height",function(a){return h-b.y(a.value)}),b.updateDescription()},a.prototype.updateIncomeLine=function(a){var b=this;b.income=a;var c=b.xLinear(b.income);c=Math.min(Math.max(c,0),w),b.incomeLine.transition().duration(500).attr("transform","translate("+c+","+-m.top+")"),b.barGroups.classed("highlighted",function(a){return b.income>a.incomeLower&&a.incomeUpper}),b.updateDescription()},a.prototype.updateDescription=function(){var a=this,b=a.data[0].profession,c="public"==a.data[0].publicprivate?"offentlig sektor":"privat sektor",d=d3.sum(a.data.filter(function(b){return a.income>b.incomeLower&&b.incomeUpper}).map(function(a){return a.value}));a.description.select(".income").text(formatLargeNum(a.income)+" kronor"),a.description.select(".amount").text(formatPercentText(d)),a.description.select(".profession").text(pluralize(b).toLowerCase()),a.description.select(".publicprivate").text(c)},a.prototype.resize=function(){var a=this;a.svg.remove(),a.drawChart()},a}();var locale=d3.locale({decimal:",",thousands:" ",grouping:[3],currency:["","SEK"],dateTime:"%A den %d %B %Y %X",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["fm","em"],days:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"],shortDays:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],shortMonths:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"]}),formatPercent=locale.numberFormat("%"),formatPercentDecimal=locale.numberFormat(".1%"),formatPercentText=function(a){return formatPercent(a).replace("%"," procent")},formatLargeNum=locale.numberFormat(","),pluralize=function(a){return a?"e"==a.slice(-1)?a+"rna":a+"erna":""};