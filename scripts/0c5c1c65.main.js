function extend(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function initHelpers(){console.log(),d3.selectAll(".helper").each(function(a){var a=this,b=d3.select(a.getAttribute("data-target")),c=b.node().getBoundingClientRect(),d=a.getBoundingClientRect();d3.selectAll(a).classed("show",!0);var e=c.left+c.width/2-d.width/2,f=d3.select(a).classed("bottom")?c.top-d.height-14:c.top+d.height;console.log(f),d3.select(a).style("left",e+"px").style("top",f+"px")}),d3.select("body").on("click",function(){d3.selectAll(".helper").classed("show",!1)})}function initPromo(){var a=d3.select("#promo"),b=["Vill du också veta vad personer födda samma år som du tjänar?","Också nyfiken på vad akademiker från samma del av landet som du tjänar?","Vill du också veta vad personer som tog examen samma år som du tjänar?"],c=b[Math.floor(Math.random()*b.length)];a.selectAll(".random-sentence").text(c),a.classed("show",!0)}IncomeChart=function(){function a(a,b,c,d){var e=this;e.container=d3.select(a),defaultOpts={yMax:1,isIframe:!1},e.opts=extend(defaultOpts,d),e.data=b,e.income=c,e.description=e.container.append("div").attr("class","description").html('Men en månadslön på <span class="income"></span> tjänar du mer än <span class="amount"></span> av <span class="profession"></span> inom <span class="publicprivate"></span>.'),e.xOrdinal=d3.scale.ordinal().domain(b.map(function(a){return a.income}));var f=b[0].incomeUpper-999,g=b[b.length-1].incomeLower+999;e.xLinear=d3.scale.linear().domain([f,g]),e.y=d3.scale.linear().domain([0,e.opts.yMax]),e.drawChart(),d3.select(window).on("resize",function(){e.resize()})}function b(a,b){return b>=a.incomeLower}return a.prototype.drawChart=function(){var a=this,b=a.container[0][0].offsetWidth;a.margins=m={top:40,right:.1*b,bottom:45,left:50},a.width=w=b-m.left-m.right,a.height=h=.5*w,a.pointRadius=.01*b;.7*m.bottom+"px";a.description.style("left",m.left+.6*w+"px").style("top",m.top+.05*h+"px").style("max-width",m.left+.25*w+"px"),a.svg=a.container.append("svg").attr("width",w+m.left+m.right).attr("height",h+m.top+m.bottom),a.chart=a.svg.append("g").attr("transform","translate("+m.left+", "+m.top+")"),a.xOrdinal.rangeBands([0,w],0,0),a.xLinear.range([0,w]),a.y.range([h,0]);var c=d3.svg.axis().scale(a.xOrdinal).orient("bottom"),d=d3.svg.axis().scale(a.y).tickFormat(formatPercent).orient("left"),e=d3.tip().attr("class","d3-tip").direction("n").offset([-10,0]).html(function(a){var b=formatLargeNum(a.incomeLower),c=a.incomeUpper?formatLargeNum(a.incomeUpper):"",d=a.value<.01?"Färre än en procent":formatPercentText(a.value);return d+" tjänar <br/>"+b+"-"+c+" kr"});a.chart.call(e),a.chart.append("g").attr("class","y axis").call(d);var f=a.chart.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(c);f.selectAll(".tick text").text(function(a){var b=a.split("-")[0];return b%1e4==0?formatLargeNum(b):""}),f.append("text").attr("x",w/2).attr("y",m.bottom-20).attr("dy",".7em").style("text-anchor","middle").attr("class","title").text("Månadslön"),a.incomeLine=a.chart.append("g").attr("class","income-line").attr("transform","translate("+a.xLinear(a.income)+","+-m.top+")"),a.incomeLine.append("line").attr("class","line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",h+m.top),a.incomeLine.append("text").attr("transform","rotate(90)").attr("y",-5).attr("class","label").text("Din lön"),a.barGroups=a.chart.selectAll(".bar-group").data(a.data,function(a){return a.income}).enter().append("g").attr("class","bar-group").attr("transform",function(b){var c=a.xOrdinal(b.income),d=a.y(b.value);return"translate("+c+","+d+")"}),a.barGroups.append("rect").attr("class","bar").attr("width",a.xOrdinal.rangeBand()).attr("height",function(b){return h-a.y(b.value)}).on("mouseover",e.show).on("mouseout",e.hide),a.updateIncomeLine(a.income),a.isIframe&&pymChild.sendHeight()},a.prototype.updateData=function(a){var b=this;b.data=a;var c=700,d=b.barGroups.data(b.data,function(a){return a.income}).transition().duration(c);d.attr("transform",function(a){var c=b.xOrdinal(a.income),d=b.y(a.value);return"translate("+c+","+d+")"}),d.select(".bar").attr("height",function(a){return h-b.y(a.value)}),b.updateDescription()},a.prototype.updateIncomeLine=function(a){var c=this;c.income=a;var d=c.xLinear(c.income);d=Math.min(Math.max(d,0),w),c.incomeLine.transition().duration(500).attr("transform","translate("+d+","+-m.top+")"),c.barGroups.classed("highlighted",function(a){return b(a,c.income)}),c.updateDescription()},a.prototype.updateDescription=function(){var a=this,b=a.data[0].profession,c="public"==a.data[0].publicprivate?"offentlig sektor":"privat sektor",d=a.getPercent(a.income);a.description.select(".income").text(formatLargeNum(a.income)+" kronor"),a.description.select(".amount").text(formatPercentText(d)),a.description.select(".profession").text(pluralize(b).toLowerCase()),a.description.select(".publicprivate").text(c)},a.prototype.getPercent=function(a){var c=this,d=c.data.filter(function(c){return b(c,a)}),e=d.length,f=d3.sum(d.map(function(a,b){if(b==e-1){var d=1-(a.incomeUpper-c.income)/(a.incomeUpper-a.incomeLower);d=Math.max(0,d);var f=d*a.value;return f}return a.value}));return f},a.prototype.resize=function(){var a=this;a.svg.remove(),a.drawChart()},a}();var locale=d3.locale({decimal:",",thousands:" ",grouping:[3],currency:["","SEK"],dateTime:"%A den %d %B %Y %X",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["fm","em"],days:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"],shortDays:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],shortMonths:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"]}),formatPercent=locale.numberFormat("%"),formatPercentDecimal=locale.numberFormat(".1%"),formatPercentText=function(a){return formatPercent(a).replace("%"," procent")},formatLargeNum=locale.numberFormat(","),pluralize=function(a){return a?"e"==a.slice(-1)?a+"rna":a+"erna":""};UI=function(){function a(a,b){var c=this;c.data=b,c.elem=d3.select(a),c.elems={profession:c.elem.select("#profession"),income:c.elem.select("#income"),publicprivate:c.elem.select("#publicprivate")}}return a.prototype.renderProfessions=function(){var a=this,b=d3.set(a.data.map(function(a){return a.profession})).values().sort();a.elems.profession.selectAll("option").data(b,function(a){return a}).enter().append("option").attr("value",function(a){return a}).text(function(a){return a.toLowerCase()})},a.prototype.select=function(a,b){var c=this;c.elems[a].node().value=b},a.prototype.profession=function(){var a=this,b=a.elems.profession.node().value;return{value:b,valid:""!==b}},a.prototype.income=function(){var a=this,b=+a.elems.income.node().value.trim();return{value:b,valid:!isNaN(b)}},a.prototype.publicprivate=function(){var a=this,b=a.elems.publicprivate.node().value;return{value:b,valid:""!==b}},a.prototype.validate=function(){var a=this,b=["income","profession","publicprivate"],c=[];return b.forEach(function(b){var d=a[b]().valid;d3.select(".helper[data-target='#"+b+"']").classed("show",!d),c.push(d)}),[c].every(Boolean)},a}();